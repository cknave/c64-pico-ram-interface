<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="753px" preserveAspectRatio="none" style="width:737px;height:753px;background:#FFFFFF;" version="1.1" viewBox="0 0 737 753" width="737px" zoomAndPan="magnify"><defs><filter height="300%" id="fzp4qr31lg26b" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="168" x="281" y="28.8838">Handling a command</text><rect fill="#FFFFFF" filter="url(#fzp4qr31lg26b)" height="104.7437" style="stroke:#000000;stroke-width:2.0;" width="514" x="206" y="325.4854"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="43" x2="43" y1="90.8955" y2="694.7163"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="133" x2="133" y1="90.8955" y2="694.7163"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="267" x2="267" y1="90.8955" y2="694.7163"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="380" x2="380" y1="90.8955" y2="694.7163"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="518" x2="518" y1="90.8955" y2="694.7163"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="657" x2="657" y1="90.8955" y2="694.7163"/><rect fill="#FEFECE" filter="url(#fzp4qr31lg26b)" height="30.0986" style="stroke:#A80036;stroke-width:1.5;" width="73" x="5" y="55.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="12" y="75.9287">Pico CPU</text><rect fill="#FEFECE" filter="url(#fzp4qr31lg26b)" height="30.0986" style="stroke:#A80036;stroke-width:1.5;" width="73" x="5" y="693.7163"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="12" y="713.8481">Pico CPU</text><rect fill="#FEFECE" filter="url(#fzp4qr31lg26b)" height="30.0986" style="stroke:#A80036;stroke-width:1.5;" width="78" x="92" y="55.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="99" y="75.9287">GPIO pins</text><rect fill="#FEFECE" filter="url(#fzp4qr31lg26b)" height="30.0986" style="stroke:#A80036;stroke-width:1.5;" width="78" x="92" y="693.7163"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="99" y="713.8481">GPIO pins</text><path d="M221,48.6982 L314,48.6982 C319,48.6982 319,69.7969 319,69.7969 C319,69.7969 319,90.8955 314,90.8955 L221,90.8955 C216,90.8955 216,69.7969 216,69.7969 C216,69.7969 216,48.6982 221,48.6982 " fill="#FEFECE" filter="url(#fzp4qr31lg26b)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M314,48.6982 C309,48.6982 309,69.7969 309,69.7969 C309,90.8955 314,90.8955 314,90.8955 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="221" y="66.8301">command sm</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="236" y="82.9287">TX FIFO</text><path d="M221,693.7163 L314,693.7163 C319,693.7163 319,714.8149 319,714.8149 C319,714.8149 319,735.9136 314,735.9136 L221,735.9136 C216,735.9136 216,714.8149 216,714.8149 C216,714.8149 216,693.7163 221,693.7163 " fill="#FEFECE" filter="url(#fzp4qr31lg26b)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M314,693.7163 C309,693.7163 309,714.8149 309,714.8149 C309,735.9136 314,735.9136 314,735.9136 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="221" y="711.8481">command sm</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="236" y="727.9468">TX FIFO</text><path d="M334,48.6982 L427,48.6982 C432,48.6982 432,69.7969 432,69.7969 C432,69.7969 432,90.8955 427,90.8955 L334,90.8955 C329,90.8955 329,69.7969 329,69.7969 C329,69.7969 329,48.6982 334,48.6982 " fill="#FEFECE" filter="url(#fzp4qr31lg26b)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M427,48.6982 C422,48.6982 422,69.7969 422,69.7969 C422,90.8955 427,90.8955 427,90.8955 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="334" y="66.8301">command sm</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="348.5" y="82.9287">RX FIFO</text><path d="M334,693.7163 L427,693.7163 C432,693.7163 432,714.8149 432,714.8149 C432,714.8149 432,735.9136 427,735.9136 L334,735.9136 C329,735.9136 329,714.8149 329,714.8149 C329,714.8149 329,693.7163 334,693.7163 " fill="#FEFECE" filter="url(#fzp4qr31lg26b)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M427,693.7163 C422,693.7163 422,714.8149 422,714.8149 C422,735.9136 427,735.9136 427,735.9136 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="334" y="711.8481">command sm</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="348.5" y="727.9468">RX FIFO</text><rect fill="#FEFECE" filter="url(#fzp4qr31lg26b)" height="46.1973" style="stroke:#A80036;stroke-width:1.5;" width="148" x="442" y="39.6982"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="449" y="59.8301">address decoder PIO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="472" y="75.9287">state machine</text><rect fill="#FEFECE" filter="url(#fzp4qr31lg26b)" height="46.1973" style="stroke:#A80036;stroke-width:1.5;" width="148" x="442" y="693.7163"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="449" y="713.8481">address decoder PIO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="472" y="729.9468">state machine</text><rect fill="#FEFECE" filter="url(#fzp4qr31lg26b)" height="46.1973" style="stroke:#A80036;stroke-width:1.5;" width="102" x="604" y="39.6982"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="611" y="59.8301">command PIO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="611" y="75.9287">state machine</text><rect fill="#FEFECE" filter="url(#fzp4qr31lg26b)" height="46.1973" style="stroke:#A80036;stroke-width:1.5;" width="102" x="604" y="693.7163"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="611" y="713.8481">command PIO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="611" y="729.9468">state machine</text><polygon fill="#A80036" points="255.5,132.793,265.5,136.793,255.5,140.793,259.5,136.793" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="43.5" x2="261.5" y1="136.793" y2="136.793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="50.5" y="124.5637">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="61.5" y="117.0894">Put a value on the TX FIFO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="61.5" y="132.0381">to indicate ready for commands</text><polygon fill="#A80036" points="368.5,161.7417,378.5,165.7417,368.5,169.7417,372.5,165.7417" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="43.5" x2="374.5" y1="165.7417" y2="165.7417"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="50.5" y="160.9868">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="61.5" y="160.9868">Wait for a command</text><rect fill="#EEEEEE" filter="url(#fzp4qr31lg26b)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="730" x="0" y="194.2161"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="730" y1="194.2161" y2="194.2161"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="730" y1="197.2161" y2="197.2161"/><rect fill="#EEEEEE" filter="url(#fzp4qr31lg26b)" height="22.9487" style="stroke:#000000;stroke-width:2.0;" width="265" x="232.5" y="183.7417"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="247" x="238.5" y="199.9355">The C64 reads from the command area</text><polygon fill="#A80036" points="506,248.5879,516,252.5879,506,256.5879,510,252.5879" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="133" x2="512" y1="252.5879" y2="252.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="140" y="240.3586">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="151" y="232.8843">Wait for ROM read to start</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="151" y="247.833">(ROML or ROMH low)</text><polygon fill="#A80036" points="645,277.5366,655,281.5366,645,285.5366,649,281.5366" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="518" x2="651" y1="281.5366" y2="281.5366"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="525" y="276.7817">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="536" y="276.7817">Trigger by IRQ</text><polygon fill="#A80036" points="645,306.4854,655,310.4854,645,314.4854,649,310.4854" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="133" x2="651" y1="310.4854" y2="310.4854"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="140" y="305.7305">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="151" y="305.7305">Read the low</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="80" x="230" y="305.7305">8-bit address</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="314" y="305.7305">from address bus</text><path d="M206,325.4854 L271,325.4854 L271,331.4854 L261,341.4854 L206,341.4854 L206,325.4854 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="104.7437" style="stroke:#000000;stroke-width:2.0;" width="514" x="206" y="325.4854"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20" x="221" y="338.6792">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="134" x="286" y="337.8032">[if the address is not 00]</text><polygon fill="#A80036" points="391.5,374.3315,381.5,378.3315,391.5,382.3315,387.5,378.3315" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="385.5" x2="656" y1="378.3315" y2="378.3315"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="397.5" y="366.1023">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="408.5" y="358.6279">put</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="80" x="430.5" y="358.6279">8-bit address</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="408.5" y="373.5767">on RX FIFO</text><polygon fill="#A80036" points="645,418.229,655,422.229,645,426.229,649,422.229" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="267.5" x2="651" y1="422.229" y2="422.229"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="274.5" y="409.9998">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="285.5" y="402.5254">consume the value from the TX FIFO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="285.5" y="417.4741">to indicate the CPU is busy</text><polygon fill="#A80036" points="144,469.1265,134,473.1265,144,477.1265,140,473.1265" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138" x2="656" y1="473.1265" y2="473.1265"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="150" y="460.8972">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="161" y="453.4229">Write the STATUS register to data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="161" y="468.3716">bus and set "output enable" low</text><polygon fill="#A80036" points="506,513.0239,516,517.0239,506,521.0239,510,517.0239" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="133" x2="512" y1="517.0239" y2="517.0239"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="140" y="504.7947">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="151" y="497.3203">Wait for ROM read to end</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="151" y="512.269">(ROML or ROMH high)</text><polygon fill="#A80036" points="144,541.9727,134,545.9727,144,549.9727,140,545.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138" x2="517" y1="545.9727" y2="545.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="150" y="541.2178">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="168" y="541.2178">Set "output enable" high</text><polygon fill="#A80036" points="54.5,585.8701,44.5,589.8701,54.5,593.8701,50.5,589.8701" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="48.5" x2="379.5" y1="589.8701" y2="589.8701"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="60.5" y="577.6409">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="78.5" y="570.1665">Pico receives the command</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="78.5" y="585.1152">from the RX FIFO</text><rect fill="#EEEEEE" filter="url(#fzp4qr31lg26b)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="730" x="0" y="618.3445"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="730" y1="618.3445" y2="618.3445"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="730" y1="621.3445" y2="621.3445"/><rect fill="#EEEEEE" filter="url(#fzp4qr31lg26b)" height="22.9487" style="stroke:#000000;stroke-width:2.0;" width="219" x="255.5" y="607.8701"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="201" x="261.5" y="624.064">The Pico handles the command</text><polygon fill="#A80036" points="255.5,672.7163,265.5,676.7163,255.5,680.7163,259.5,676.7163" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="43.5" x2="261.5" y1="676.7163" y2="676.7163"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="50.5" y="664.4871">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="68.5" y="657.0127">Put a value on the TX FIFO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="68.5" y="671.9614">to indicate ready for commands</text><!--MD5=[89edf175ea4b0239d855c6454a4ef87f]
@startuml
autonumber

participant "Pico CPU" as P
participant "GPIO pins" as G
queue "command sm\nTX FIFO" as TX
queue "command sm\nRX FIFO" as RX
participant "address decoder PIO\nstate machine" as AD
participant "command PIO\nstate machine" as CSM

title Handling a command

P -> TX: Put a value on the TX FIFO\nto indicate ready for commands

P -> RX: Wait for a command

== The C64 reads from the command area ==

G -> AD: Wait for ROM read to start\n(ROML or ROMH low)

  AD -> CSM: Trigger by IRQ

G -> CSM: Read the low <b>8-bit address</b> from address bus

  opt if the address is not 00

    CSM -> RX: put <b>8-bit address</b>\non RX FIFO
    
    TX -> CSM: consume the value from the TX FIFO\nto indicate the CPU is busy

  end

  CSM -> G: Write the STATUS register to data\nbus and set "output enable" low

G -> AD: Wait for ROM read to end\n(ROML or ROMH high)

AD -> G: Set "output enable" high

P <- RX: Pico receives the command\nfrom the RX FIFO

== The Pico handles the command ==

P -> TX: Put a value on the TX FIFO\nto indicate ready for commands

@enduml

PlantUML version 1.2022.0(Tue Jan 11 11:16:42 EST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>